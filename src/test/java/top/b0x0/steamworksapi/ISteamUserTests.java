package top.b0x0.steamworksapi;

import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.HttpMethod;
import org.springframework.http.ResponseEntity;
import org.springframework.web.client.RestTemplate;
import top.b0x0.steamworksapi.common.SteamApiEnum;

/**
 * @author ManJiis
 * @since 2021-07-29
 * @since JDK1.8
 */
@SpringBootTest
public class ISteamUserTests {

    @Autowired
    RestTemplate restTemplate;

    private static final String steamId64 = "76561198332498227";
    private static final String steamWebApiKey = "7BC3C7D5EDBC6B95B350ECA322D909B7";

    /**
     * 获取好友列表。
     */
    @Test
    public void ISteamUser_GetFriendList_v1() {
        String url = SteamApiEnum.buildUrl(SteamApiEnum.ISteamUser_GetFriendList_v1);
        url = url + "?" + "key=" + steamWebApiKey + "&steamid=" + steamId64;
        System.out.println("url = " + url);
        ResponseEntity<String> responseEntity = restTemplate.exchange(url, HttpMethod.GET, null, String.class);
        String body = responseEntity.getBody();
        System.out.println("body = " + body);
        // {"friendslist":{"friends":[{"steamid":"76561197962372546","relationship":"friend","friend_since":1625454081},{"steamid":"76561197997675136","relationship":"friend","friend_since":1507024020},{"steamid":"76561197998500968","relationship":"friend","friend_since":1509414245},{"steamid":"76561198008309815","relationship":"friend","friend_since":1588425003},{"steamid":"76561198048395610","relationship":"friend","friend_since":1589209773},{"steamid":"76561198102881968","relationship":"friend","friend_since":1507352161},{"steamid":"76561198105289310","relationship":"friend","friend_since":1589207293},{"steamid":"76561198109190565","relationship":"friend","friend_since":1506167423},{"steamid":"76561198111574878","relationship":"friend","friend_since":1589282906},{"steamid":"76561198116080087","relationship":"friend","friend_since":1516110789},{"steamid":"76561198118274620","relationship":"friend","friend_since":1620999766},{"steamid":"76561198118848025","relationship":"friend","friend_since":1586582282},{"steamid":"76561198124809662","relationship":"friend","friend_since":1589207735},{"steamid":"76561198131538891","relationship":"friend","friend_since":1601026287},{"steamid":"76561198133544299","relationship":"friend","friend_since":1598777461},{"steamid":"76561198149730779","relationship":"friend","friend_since":1590200556},{"steamid":"76561198155400341","relationship":"friend","friend_since":1506163850},{"steamid":"76561198159326359","relationship":"friend","friend_since":1592098532},{"steamid":"76561198220156817","relationship":"friend","friend_since":1593104752},{"steamid":"76561198224415004","relationship":"friend","friend_since":1507007751},{"steamid":"76561198226613464","relationship":"friend","friend_since":1506170175},{"steamid":"76561198234473976","relationship":"friend","friend_since":1589207220},{"steamid":"76561198249555986","relationship":"friend","friend_since":1507005592},{"steamid":"76561198251597496","relationship":"friend","friend_since":1508473834},{"steamid":"76561198253674158","relationship":"friend","friend_since":1602934352},{"steamid":"76561198259131448","relationship":"friend","friend_since":1589211772},{"steamid":"76561198267533172","relationship":"friend","friend_since":1589244373},{"steamid":"76561198274298321","relationship":"friend","friend_since":1589222800},{"steamid":"76561198275587857","relationship":"friend","friend_since":1508405960},{"steamid":"76561198282458871","relationship":"friend","friend_since":1508474446},{"steamid":"76561198283346000","relationship":"friend","friend_since":1508049326},{"steamid":"76561198315593352","relationship":"friend","friend_since":1589719606},{"steamid":"76561198316128447","relationship":"friend","friend_since":1589208393},{"steamid":"76561198317406520","relationship":"friend","friend_since":1508478186},{"steamid":"76561198319427736","relationship":"friend","friend_since":1496766275},{"steamid":"76561198323785867","relationship":"friend","friend_since":1515502673},{"steamid":"76561198332207056","relationship":"friend","friend_since":1507570839},{"steamid":"76561198334587238","relationship":"friend","friend_since":1506857176},{"steamid":"76561198334751919","relationship":"friend","friend_since":1589208913},{"steamid":"76561198335083754","relationship":"friend","friend_since":1589208613},{"steamid":"76561198335184457","relationship":"friend","friend_since":1589258780},{"steamid":"76561198340022361","relationship":"friend","friend_since":1506166636},{"steamid":"76561198342515375","relationship":"friend","friend_since":1508485476},{"steamid":"76561198347387945","relationship":"friend","friend_since":1589428622},{"steamid":"76561198349503027","relationship":"friend","friend_since":1510451145},{"steamid":"76561198351218716","relationship":"friend","friend_since":1589244376},{"steamid":"76561198353144663","relationship":"friend","friend_since":1508048083},{"steamid":"76561198357834377","relationship":"friend","friend_since":1508741777},{"steamid":"76561198359209259","relationship":"friend","friend_since":1509431510},{"steamid":"76561198362590476","relationship":"friend","friend_since":1590404648},{"steamid":"76561198364129848","relationship":"friend","friend_since":1589206997},{"steamid":"76561198364794334","relationship":"friend","friend_since":1506502499},{"steamid":"76561198367621292","relationship":"friend","friend_since":1508483901},{"steamid":"76561198369046794","relationship":"friend","friend_since":1506171366},{"steamid":"76561198370906292","relationship":"friend","friend_since":1496809668},{"steamid":"76561198372805693","relationship":"friend","friend_since":1592617785},{"steamid":"76561198379876030","relationship":"friend","friend_since":1592099833},{"steamid":"76561198380670676","relationship":"friend","friend_since":1593073817},{"steamid":"76561198381987369","relationship":"friend","friend_since":1589245696},{"steamid":"76561198383543079","relationship":"friend","friend_since":1514794250},{"steamid":"76561198391437648","relationship":"friend","friend_since":1507370553},{"steamid":"76561198392478239","relationship":"friend","friend_since":1506171263},{"steamid":"76561198393264101","relationship":"friend","friend_since":1589207591},{"steamid":"76561198398984194","relationship":"friend","friend_since":1589245294},{"steamid":"76561198400659451","relationship":"friend","friend_since":1506165656},{"steamid":"76561198402438240","relationship":"friend","friend_since":1507556173},{"steamid":"76561198406176835","relationship":"friend","friend_since":1506173154},{"steamid":"76561198408880270","relationship":"friend","friend_since":1596339401},{"steamid":"76561198409136608","relationship":"friend","friend_since":1589206893},{"steamid":"76561198410762114","relationship":"friend","friend_since":1589214107},{"steamid":"76561198412943644","relationship":"friend","friend_since":1589249372},{"steamid":"76561198415536035","relationship":"friend","friend_since":1528692820},{"steamid":"76561198415668069","relationship":"friend","friend_since":1589298827},{"steamid":"76561198416622218","relationship":"friend","friend_since":1508142631},{"steamid":"76561198416659994","relationship":"friend","friend_since":1589208739},{"steamid":"76561198418894092","relationship":"friend","friend_since":1593073780},{"steamid":"76561198420644169","relationship":"friend","friend_since":1592982326},{"steamid":"76561198422799146","relationship":"friend","friend_since":1506862470},{"steamid":"76561198425153627","relationship":"friend","friend_since":1592661716},{"steamid":"76561198437394248","relationship":"friend","friend_since":1589280078},{"steamid":"76561198443746436","relationship":"friend","friend_since":1589208082},{"steamid":"76561198444365785","relationship":"friend","friend_since":1589208458},{"steamid":"76561198445111217","relationship":"friend","friend_since":1589207601},{"steamid":"76561198797904053","relationship":"friend","friend_since":1592639459},{"steamid":"76561198805997586","relationship":"friend","friend_since":1589208722},{"steamid":"76561198815053970","relationship":"friend","friend_since":1522743415},{"steamid":"76561198835005445","relationship":"friend","friend_since":1586527150},{"steamid":"76561198835635849","relationship":"friend","friend_since":1590936910},{"steamid":"76561198842617325","relationship":"friend","friend_since":1589241477},{"steamid":"76561198845414274","relationship":"friend","friend_since":1590182761},{"steamid":"76561198845517655","relationship":"friend","friend_since":1598442452},{"steamid":"76561198846340887","relationship":"friend","friend_since":1589210329},{"steamid":"76561198850045639","relationship":"friend","friend_since":1589298826},{"steamid":"76561198851595424","relationship":"friend","friend_since":1589212324},{"steamid":"76561198853340037","relationship":"friend","friend_since":1589345271},{"steamid":"76561198857305358","relationship":"friend","friend_since":1596339548},{"steamid":"76561198864544510","relationship":"friend","friend_since":1616893831},{"steamid":"76561198865183278","relationship":"friend","friend_since":1589213990},{"steamid":"76561198869060410","relationship":"friend","friend_since":1589210382},{"steamid":"76561198869083468","relationship":"friend","friend_since":1589244375},{"steamid":"76561198884176745","relationship":"friend","friend_since":1590217401},{"steamid":"76561198892472398","relationship":"friend","friend_since":1589207412},{"steamid":"76561198899280167","relationship":"friend","friend_since":1589345273},{"steamid":"76561198918710165","relationship":"friend","friend_since":1592221238},{"steamid":"76561198923013311","relationship":"friend","friend_since":1594375567},{"steamid":"76561198929179220","relationship":"friend","friend_since":1589207155},{"steamid":"76561198940322036","relationship":"friend","friend_since":1589250515},{"steamid":"76561198957388089","relationship":"friend","friend_since":1589244371},{"steamid":"76561198961708575","relationship":"friend","friend_since":1589249055},{"steamid":"76561198964210101","relationship":"friend","friend_since":1589501618},{"steamid":"76561198970464210","relationship":"friend","friend_since":1598445737},{"steamid":"76561198981058032","relationship":"friend","friend_since":1589345275},{"steamid":"76561198983376130","relationship":"friend","friend_since":1589345276},{"steamid":"76561198985806554","relationship":"friend","friend_since":1589241609},{"steamid":"76561198987739195","relationship":"friend","friend_since":1589209464},{"steamid":"76561198993376853","relationship":"friend","friend_since":1589210068},{"steamid":"76561198994206841","relationship":"friend","friend_since":1592628801},{"steamid":"76561198999554181","relationship":"friend","friend_since":1586878705},{"steamid":"76561199000420457","relationship":"friend","friend_since":1589209566},{"steamid":"76561199012460216","relationship":"friend","friend_since":1593168841},{"steamid":"76561199014085590","relationship":"friend","friend_since":1589345281},{"steamid":"76561199017019312","relationship":"friend","friend_since":1589206723},{"steamid":"76561199023130060","relationship":"friend","friend_since":1594123249},{"steamid":"76561199056063098","relationship":"friend","friend_since":1593847427},{"steamid":"76561199078551261","relationship":"friend","friend_since":1619356648}]}}
        JSONObject jsonObject = JSONObject.parseObject(body);
        JSONObject friendslist = (JSONObject) jsonObject.get("friendslist");
        JSONArray friends = (JSONArray) friendslist.get("friends");
        System.out.println("friends = " + friends);
    }
}
